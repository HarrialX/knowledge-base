Original Source:
https://github.com/torvalds/linux/commit/13d518074a952d33d47c428419693f63389547e9

Commit history:

  @@ -1663,8 +1663,10 @@ SYSCALL_DEFINE4(epoll_ctl, int, epfd, int, op, int, fd,
   if (op == EPOLL_CTL_ADD) {
   if (is_file_epoll(tfile)) {
  			error = -ELOOP;
-  if (ep_loop_check(ep, tfile) != 0)
+  if (ep_loop_check(ep, tfile) != 0) {
+  clear_tfile_check_list();
   goto error_tgt_fput;
+ 			}
  		} else
   list_add(&tfile->f_tfile_llink, &tfile_check_list);
  	}
  
