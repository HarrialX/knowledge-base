Original Source:
https://github.com/canarymail/mailcore2/commit/45acb4efbcaa57a20ac5127dc976538671fce018

Commit history:

  @@ -682,6 +682,13 @@ void IMAPSession::connect(ErrorCode * pError)
              * pError = ErrorTLSNotAvailable;
   goto close;
          }
+ 
+  mIsCertificateValid = checkCertificate();
+  if (isCheckCertificateEnabled() && !mIsCertificateValid) {
+             * pError = ErrorCertificate;
+  goto close;
+         }
+ 
   break;
  
   case ConnectionTypeTLS:
  
