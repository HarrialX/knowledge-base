Original Source:
https://github.com/osTicket/osTicket/pull/5616/commits/fb570820ef1138776f929a179906e1d8089179d9

Commit history:

  @@ -15,7 +15,7 @@
   $info['isactive']=isset($info['isactive'])?$info['isactive']:1;
   $qs += array('a' => $_REQUEST['a']);
  }
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  ?>
  <form action="apikeys.php?<?php echo Http::build_query($qs); ?>" method="post" class="save">
   <?php csrf_token(); ?>
  
  @@ -17,7 +17,7 @@
   $qs += array('a' => $_REQUEST['a']);
  }
  
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  ?>
  <form action="banlist.php?<?php echo Http::build_query($qs); ?>" method="post" class="save">
   <?php csrf_token(); ?>
  
  @@ -110,7 +110,7 @@
   <tr>
   <td colspan=2>
   <textarea class="richtext no-bar" name="notes" cols="21"
-  rows="8" style="width: 80%;"><?php echo $info['notes']; ?></textarea>
+  rows="8" style="width: 80%;"><?php echo Format::sanitize($info['notes']); ?></textarea>
   </td>
   </tr>
   </tbody>
  
  @@ -33,7 +33,7 @@
   $submit_text=__('Add');
   $qs += array('a' => $_REQUEST['a']);
  }
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  
  ?>
  <form action="categories.php?<?php echo Http::build_query($qs); ?>" method="post" class="save">
  
  @@ -16,7 +16,7 @@
   $newcount=4;
  }
  
- $info=Format::htmlchars(($errors && $_POST) ? array_merge($info,$_POST) : $info);
+ $info=Format::htmlchars(($errors && $_POST) ? array_merge($info,$_POST) : $info, true);
  
  ?>
  <form action="" method="post" class="save">
  
  @@ -32,7 +32,7 @@
   $info['smtp_auth'] = 1;
   $qs += array('a' => $_REQUEST['a']);
  }
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  ?>
  <h2><?php echo $title; ?>
   <?php if (isset($info['email'])) { ?><small>
  
  @@ -250,7 +250,7 @@ class="richtext draft" <?php
   </div>
   <div style="margin-top:10px"></div>
   <textarea class="richtext no-bar" name="notes" cols="21"
-  rows="8" style="width: 80%;"><?php echo $info['notes']; ?></textarea>
+  rows="8" style="width: 80%;"><?php echo Format::sanitize($info['notes']); ?></textarea>
  </div>
  
  <p style="text-align:center;">
  
  @@ -21,7 +21,7 @@
   $info['rules'] = array();
   $qs += array('a' => $_REQUEST['a']);
  }
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  ?>
  <form action="filters.php?<?php echo Http::build_query($qs); ?>" method="post" class="save">
   <?php csrf_token(); ?>
  
  @@ -184,7 +184,7 @@
   <em><strong><?php echo __('Internal Notes'); ?></strong>:
   <?php echo __("Be liberal, they're internal"); ?></em>
   <textarea class="richtext no-bar" name="notes" cols="21"
-  rows="8" style="width: 80%;"><?php echo $info['notes']; ?></textarea>
+  rows="8" style="width: 80%;"><?php echo Format::sanitize($info['notes']); ?></textarea>
   </div>
  </div>
  
  
  @@ -15,7 +15,7 @@
   $newcount=4;
  }
  
- $info = Format::htmlchars(($errors && $_POST) ? array_merge($info, $_POST) : $info);
+ $info = Format::htmlchars(($errors && $_POST) ? array_merge($info, $_POST) : $info, true);
  
  ?>
  <form action="" method="post" class="save">
  
  @@ -18,7 +18,7 @@
   $info['disable_overdue_alerts']=isset($info['disable_overdue_alerts'])?$info['disable_overdue_alerts']:0;
   $qs += array('a' => $_REQUEST['a']);
  }
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  ?>
  <form action="slas.php?<?php echo Http::build_query($qs); ?>" method="post" class="save">
   <?php csrf_token(); ?>
  
  @@ -17,7 +17,7 @@
   $info['lang_id'] = $cfg->getPrimaryLanguage();
   $qs += array('a' => $_REQUEST['a']);
  }
- $info=Format::htmlchars(($errors && $_POST)?$_POST:$info);
+ $info=Format::htmlchars(($errors && $_POST)?$_POST:$info, true);
  ?>
  <form action="templates.php?<?php echo Http::build_query($qs); ?>" method="post" class="save">
   <?php csrf_token(); ?>
  
