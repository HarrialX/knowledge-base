Original Source:
https://github.com/evanphx/json-patch/commit/4c9aadca8f89e349c999f04e28199e96e81aba03#diff-65c563bba473be9d94ce4d033f74810e

Commit history:

  @@ -397,7 +397,9 @@ func (d *partialArray) add(key string, val *lazyNode) error {
  		}
   idx = len(ary) - idx
  	}
- 
+  if idx < 0 || idx >= len(ary) || idx > len(cur) {
+  return fmt.Errorf("Unable to access invalid index: %d", idx)
+ 	}
   copy(ary[0:idx], cur[0:idx])
   ary[idx] = val
   copy(ary[idx+1:], cur[idx:])
  
  @@ -227,6 +227,10 @@ var BadCases = []BadCase{
   `{ "name":{ "foo": "bat", "qux": "bum"}}`,
   `[ { "op": "replace", "path": "/foo/bar", "value":"baz"}]`,
  	},
+ 	{
+  `{ "foo": ["bar"]}`,
+  `[ {"op": "add", "path": "/foo/2", "value": "bum"}]`,
+ 	},
  }
  
  func TestAllCases(t *testing.T) {
  
