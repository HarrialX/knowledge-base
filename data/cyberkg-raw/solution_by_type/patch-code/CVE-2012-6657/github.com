Original Source:
https://github.com/torvalds/linux/commit/3e10986d1d698140747fcfc2761ec9cb64c1d582

Commit history:

  @@ -691,7 +691,8 @@ int sock_setsockopt(struct socket *sock, int level, int optname,
  
   case SO_KEEPALIVE:
  #ifdef CONFIG_INET
-  if (sk->sk_protocol == IPPROTO_TCP)
+  if (sk->sk_protocol == IPPROTO_TCP &&
+ 		    sk->sk_type == SOCK_STREAM)
   tcp_set_keepalive(sk, valbool);
  #endif
   sock_valbool_flag(sk, SOCK_KEEPOPEN, valbool);
  
