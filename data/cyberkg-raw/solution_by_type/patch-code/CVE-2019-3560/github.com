Original Source:
https://github.com/facebookincubator/fizz/commit/40bbb161e72fb609608d53b9d64c56bb961a6ee2

Commit history:

  @@ -39,9 +39,7 @@ folly::Optional<TLSMessage> PlaintextReadRecordLayer::read(
   if (buf.chainLength() < (cursor - buf.front()) + length) {
   return folly::none;
          }
-         length +=
-  sizeof(ContentType) + sizeof(ProtocolVersion) + sizeof(uint16_t);
-         buf.trimStart(length);
+         buf.trimStart(static_cast<size_t>(kPlaintextHeaderSize) + length);
   continue;
        } else if (msg.type != ContentType::change_cipher_spec) {
          skipEncryptedRecords_ = false;
  
  @@ -115,6 +115,16 @@ TEST_F(PlaintextRecordTest, TestSkipAndWait) {
   EXPECT_TRUE(queue_.empty());
  }
  
+ TEST_F(PlaintextRecordTest, TestSkipOversizedRecord) {
+   read_.setSkipEncryptedRecords(true);
+  addToQueue("170301fffb");
+  auto longBuf = IOBuf::create(0xfffb);
+   longBuf->append(0xfffb);
+   queue_.append(std::move(longBuf));
+  EXPECT_FALSE(read_.read(queue_).hasValue());
+  EXPECT_TRUE(queue_.empty());
+ }
+ 
  TEST_F(PlaintextRecordTest, TestWaitBeforeSkip) {
    read_.setSkipEncryptedRecords(true);
   addToQueue("170301000501234567");
  
