Original Source:
https://github.com/kajona/kajonacms/commit/8f1b18150cc2a8f27c96d9c4f94a81022fbb61e3

Commit history:

  @@ -347,10 +347,12 @@ public static function getLinkPortalHref($strPageI, $strPageE = "", $strAction =
  
  
   //create an array out of the params
-  $strParsedSystemid = "";
-  $arrParams = self::parseParamsString($strParams, $strParsedSystemid);
-  if($strSystemid == "" && validateSystemid($strParsedSystemid))
-  $strSystemid = $strParsedSystemid;
+  if($strSystemid != "") {
+  $strParams .= "&systemid=".$strSystemid;
+  $strSystemid = "";
+         }
+ 
+  $arrParams = self::parseParamsString($strParams, $strSystemid);
  
   // any anchors set to the page?
   $strAnchor = "";
  @@ -496,7 +498,11 @@ private static function parseParamsString($strParams, &$strSystemid = "") {
   $arrEntry = explode("=", $strValue);
  
   if(count($arrEntry) == 2 && $arrEntry[0] == "systemid") {
-  $strSystemid = $arrEntry[1];
+  //encoded and sanitized systemid param TODO: add cve number or other identifier
+  $strSystemid = urlencode($arrEntry[1]);
+  if(!validateSystemid($strSystemid))
+  $strSystemid = "";
+ 
                  unset($arrParams[$strKey]);
              }
   else if($strValue == "")
  
