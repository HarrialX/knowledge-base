Original Source:
https://github.com/simplesamlphp/simplesamlphp/commit/77df6a932d46daa35e364925eb73a175010dc904

Commit history:

  @@ -86,7 +86,7 @@ private static function _aesEncrypt($data, $secret)
   $key    = openssl_digest($secret, 'sha256');
   $method = 'AES-256-CBC';
   $ivSize = 16;
-  $iv     = substr($key, 0, $ivSize);
+  $iv     = openssl_random_pseudo_bytes($ivSize);
  
   return $iv.openssl_encrypt($data, $method, $key, $raw, $iv);
      }
  
