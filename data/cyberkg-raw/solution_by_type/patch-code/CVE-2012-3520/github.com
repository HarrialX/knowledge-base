Original Source:
https://github.com/torvalds/linux/commit/e0e3cea46d31d23dc40df0a49a7a2c04fe8edfea

Commit history:

  @@ -70,9 +70,11 @@ static __inline__ void scm_destroy(struct scm_cookie *scm)
  }
  
  static __inline__ int scm_send(struct socket *sock, struct msghdr *msg,
-  struct scm_cookie *scm)
+  struct scm_cookie *scm, bool forcecreds)
  {
   memset(scm, 0, sizeof(*scm));
+  if (forcecreds)
+  scm_set_cred(scm, task_tgid(current), current_cred());
   unix_get_peersec_dgram(sock, scm);
   if (msg->msg_controllen <= 0)
   return 0;
  
  @@ -1362,7 +1362,7 @@ static int netlink_sendmsg(struct kiocb *kiocb, struct socket *sock,
   if (NULL == siocb->scm)
  		siocb->scm = &scm;
  
- 	err = scm_send(sock, msg, siocb->scm);
+ 	err = scm_send(sock, msg, siocb->scm, true);
   if (err < 0)
   return err;
  
  
  @@ -1450,7 +1450,7 @@ static int unix_dgram_sendmsg(struct kiocb *kiocb, struct socket *sock,
   if (NULL == siocb->scm)
  		siocb->scm = &tmp_scm;
   wait_for_unix_gc();
- 	err = scm_send(sock, msg, siocb->scm);
+ 	err = scm_send(sock, msg, siocb->scm, false);
   if (err < 0)
   return err;
  
  @@ -1619,7 +1619,7 @@ static int unix_stream_sendmsg(struct kiocb *kiocb, struct socket *sock,
   if (NULL == siocb->scm)
  		siocb->scm = &tmp_scm;
   wait_for_unix_gc();
- 	err = scm_send(sock, msg, siocb->scm);
+ 	err = scm_send(sock, msg, siocb->scm, false);
   if (err < 0)
   return err;
  
  
