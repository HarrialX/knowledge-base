Original Source:
https://github.com/s9y/Serendipity/commit/264bf55719baacc069ff9d3cc35f0c349cde11e3

Commit history:

  @@ -6,7 +6,7 @@ Version 1.6.1 ()
  ------------------------------------------------------------------------
  
      * Improved escaping of backend plugin management for DB query
-       (Stefan Schurtz)
+  and media selector output (Stefan Schurtz)
  
      * Updated spamblock plugin to 1.78 & 1.79
        changed wordfilter to function to check with 'verify_once'
  
  @@ -293,7 +293,7 @@
   isset($serendipity['GET']['page'])   ? $serendipity['GET']['page']   : 1,
   $serendipity['thumbPerPage2'],
            ($serendipity['showMediaToolbar'] ? true : false),
-  '?serendipity[step]=1' . $add_url . '&amp;serendipity[textarea]='. $serendipity['GET']['textarea'],
+  '?serendipity[step]=1' . $add_url . '&amp;serendipity[textarea]='. htmlspecialchars($serendipity['GET']['textarea']),
   true,
   null,
   false
  
