Original Source:
https://github.com/facebook/mcrouter/commit/97e033b3bb0cb16b61bf49f0dc7f311a3e0edd1b

Commit history:

  @@ -78,13 +78,11 @@ void CarbonProtocolReader::skip(const FieldType ft) {
      }
   case FieldType::Struct: {
   readStructBegin();
-  while (true) {
-  const auto fieldType = readFieldHeader().first;
-  if (fieldType == FieldType::Stop) {
-  break;
-         }
-  skip(fieldType);
-       }
+  const auto next = readFieldHeader().first;
+  skip(next);
+  break;
+     }
+  case FieldType::Stop: {
   readStructEnd();
   break;
      }
  @@ -96,8 +94,10 @@ void CarbonProtocolReader::skip(const FieldType ft) {
   skipKVContainer();
   break;
      }
-  default: { break; }
+  default: {
+  break;
+     }
    }
  }
  
- } // carbon
+ } // namespace carbon
  @@ -245,8 +245,10 @@ class CarbonProtocolReader {
    }
  
   void readStructEnd() {
-     lastFieldId_ = nestedStructFieldIds_.back();
-     nestedStructFieldIds_.pop_back();
+  if (!nestedStructFieldIds_.empty()) {
+       lastFieldId_ = nestedStructFieldIds_.back();
+       nestedStructFieldIds_.pop_back();
+     }
    }
  
    std::pair<std::pair<FieldType, FieldType>, uint32_t>
  
