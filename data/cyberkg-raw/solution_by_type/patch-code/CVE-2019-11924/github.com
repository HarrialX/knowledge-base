Original Source:
https://github.com/facebookincubator/fizz/commit/6bf67137ef1ee5cd70c842b014c322b7deaf994b

Commit history:

  @@ -147,7 +147,7 @@ folly::Optional<TLSMessage> EncryptedReadRecordLayer::read(
   static_cast<ContentTypeType>(msg.type)));
    }
  
-  if (!msg.fragment) {
+  if (!msg.fragment || msg.fragment->empty()) {
   if (msg.type == ContentType::application_data) {
        msg.fragment = folly::IOBuf::create(0);
      } else {
  
  @@ -180,7 +180,7 @@ TEST_F(EncryptedRecordTest, TestAllPaddingHandshake) {
   expectSame(buf, "0123456789");
   return getBuf("16000000");
        }));
-  EXPECT_NO_THROW(read_.read(queue_));
+  EXPECT_ANY_THROW(read_.read(queue_));
  }
  
  TEST_F(EncryptedRecordTest, TestNoContentType) {
  
