Original Source:
https://github.com/quadule/colorscore/commit/570b5e854cecddd44d2047c44126aed951b61718

Commit history:

  @@ -1,7 +1,9 @@
+ require "shellwords"
+ 
  module Colorscore
   class Histogram
   def initialize(image_path, colors=16, depth=8)
-  output = `convert #{image_path} -resize 400x400 -format %c -dither None -quantize YIQ -colors #{colors} -depth #{depth} histogram:info:-`
+  output = `convert #{image_path.shellescape} -resize 400x400 -format %c -dither None -quantize YIQ -colors #{colors.to_i} -depth #{depth.to_i} histogram:info:-`
   @lines = output.lines.sort.reverse.map(&:strip).reject(&:empty?)
   end
  
  
