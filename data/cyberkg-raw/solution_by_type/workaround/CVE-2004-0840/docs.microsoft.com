Original Source:
https://docs.microsoft.com/en-us/security-updates/securitybulletins/2004/ms04-035

Workarounds for SMTP Vulnerability - CAN-2004-0840:
Microsoft has tested the following workaround. This workaround will not correct the underlying vulnerability but will help block known attack vectors. Workarounds may cause a reduction in functionality in some cases - in such situations this is identified below.
Use a firewall to block incoming TCP protocol network traffic on port 53 for Windows Server 2003 systems using the SMTP component, regardless of if Exchange is installed.
Use a firewall to block TCP protocol network traffic on port 53. Do not block UDP traffic on port 53 or the server will be unable to make any DNS queries to resolve domain names.
Impact of Workaround: Port 53 is used for DNS queries and responses. By blocking the TCP protocol on port 53, all DNS name resolution must be done through the UDP protocol. Large DNS responses sent through TCP can be split between multiple packets, while responses sent through UDP must fit within a single UDP packet. This means that if you rely only on UDP for DNS name resolution, you may be unable communicate with domains that return more IP addresses than can fit in a single UDP packet. Typically, each entry in a DNS response requires 16 bytes. Therefore, a single UDP response packet can contain approximately 30 IP addresses.
Note It is possible to minimize potential disruptions of DNS name resolution by implementing a metabase key. For detailed information about this, see Microsoft Knowledge Base Article 820284.
Setting the metabase key will allow SMTP to use partial UDP name resolution responses to route mail. It will not prevent TCP responses from being sent to the server, and setting the metabase key is not a substitute for blocking TCP on port 53. This metabase key affects only SMTP, and it will not affect the name resolution behavior of other services and applications.
Block TCP protocol network traffic on Windows Server 2000 Service Pack 3 or Service Pack 4 systems with Microsoft Exchange Server 2003 with no service pack installed or with Microsoft Exchange Server 2000 installed.
If you have defined External DNS Servers, you can block TCP protocol network traffic on port 53 between the Exchange server and all external DNS servers. Follow these steps to check if External DNS Servers have been configured on your Exchange server:
Start the Exchange System Manager and for each server:

Expand the Protocols container.

Expand the SMTP container.

For each SMTP virtual server:

Open the SMTP virtual server Properties.
Select the Delivery tab.
Click the Advanced button.
Click the Configure button.

Block TCP traffic on port 53 between any external DNS servers listed and the Exchange server. If there are no external DNS servers listed, you do not have to take any action. However, Microsoft strongly recommends that you apply the security update or service pack for Exchange 2003 so that you will protected if the configuration of your server changes in the future.


Impact of Workaround: This workaround will affect only SMTP traffic on the Exchange system. It will not affect name resolution by other applications and services. The external DNS servers configured in Exchange System Manager are used only by the SMTP and Exchange Routing services. With TCP traffic from these servers blocked on port 53, Exchange will automatically use partial UDP name resolution responses to route mail. There is no need to set a metabase key as described above for Windows Server 2003 in order for SMTP to take advantage of partial responses. It is possible that some mail will still be unable to be delivered. This will happen only if a valid email server IP address is not found in a partial UDP response.

Do not block both TCP and UDP for port 53. Doing so will cause all DNS name resolution to fail on the server.
If your server hosts applications that are configured to use only TCP for DNS responses, then this workaround will cause those applications to be unable to resolve domain names to IP addresses.
If your server is used primarily as an SMTP-based email server or Exchange server, messages addressed to domains that return large DNS responses may not be processed or delivered.

