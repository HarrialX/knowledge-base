{ 
  "text" : "SquirrelMail 1.4.22 (and other versions before 20170427_0200-SVN) allows post-authentication remote code execution via a sendmail.cf file that is mishandled in a popen call. It's possible to exploit this vulnerability to execute arbitrary shell commands on the remote server. The problem is in the Deliver_SendMail.class.php with the initStream function that uses escapeshellcmd() to sanitize the sendmail command before executing it. The use of escapeshellcmd() is not correct in this case since it doesn't escape whitespaces, allowing the injection of arbitrary command parameters. The problem is in -f$envelopefrom within the sendmail command line. Hence, if the target server uses sendmail and SquirrelMail is configured to use it as a command-line program, it's possible to trick sendmail into using an attacker-provided configuration file that triggers the execution of an arbitrary command. For exploitation, the attacker must upload a sendmail.cf file as an email attachment, and inject the sendmail.cf filename with the -C option within the \"Options > Personal Informations > Email Address\" setting.\n" ,
  "entities" : [ { 
    "eid" : "E1" ,
    "keyid" : "Identity#a96eccf89e1b32358d0d34ff98eb722f" ,
    "type" : "Identity" ,
    "subType" : "Organization" ,
    "value" : "squirrelmail" ,
    "begin" : 0 ,
    "end" : 12 ,
    "canonicalForm" : "SquirrelMail" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E2" ,
    "keyid" : "42b90196b487c54069097a68fe98ab6f" ,
    "type" : "MiscEntity" ,
    "subType" : "post" ,
    "value" : "post" ,
    "begin" : 73 ,
    "end" : 77 ,
    "canonicalForm" : "post" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E3" ,
    "keyid" : "TTP#cc08fcc152a544c7bf56489571f8cb60" ,
    "type" : "TTP" ,
    "subType" : "TTP" ,
    "value" : "remote code execution" ,
    "begin" : 93 ,
    "end" : 114 ,
    "canonicalForm" : "remote code execution" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E4" ,
    "keyid" : "DomainName#db428a5a9353710d4fd2c1fc4da66f19" ,
    "type" : "DomainName" ,
    "subType" : "DomainName" ,
    "value" : "sendmail.cf" ,
    "begin" : 121 ,
    "end" : 132 ,
    "canonicalForm" : "sendmail.cf" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E5" ,
    "keyid" : "FileName#527bf5267a9d03a7f33693378e16302a" ,
    "type" : "FileName" ,
    "subType" : "FileName" ,
    "value" : "Deliver_SendMail.class" ,
    "begin" : 298 ,
    "end" : 320 ,
    "canonicalForm" : "Deliver_SendMail.class" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E6" ,
    "keyid" : "Identity#d0c8b462a01ffdce346841491687b126" ,
    "type" : "Identity" ,
    "subType" : "Organization" ,
    "value" : "sendmail" ,
    "begin" : 306 ,
    "end" : 314 ,
    "canonicalForm" : "SendMail" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E7" ,
    "keyid" : "FileName#278f012f0e38c53b1e8afda58bc6ef5a" ,
    "type" : "FileName" ,
    "subType" : "FileName" ,
    "value" : "class.php" ,
    "begin" : 315 ,
    "end" : 324 ,
    "canonicalForm" : "class.php" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E8" ,
    "keyid" : "2542e60bdac9589f003be337846715a0" ,
    "type" : "MiscEntity" ,
    "subType" : "server" ,
    "value" : "target server" ,
    "begin" : 666 ,
    "end" : 679 ,
    "canonicalForm" : "target server" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E9" ,
    "keyid" : "Identity#a96eccf89e1b32358d0d34ff98eb722f" ,
    "type" : "Identity" ,
    "subType" : "Organization" ,
    "value" : "squirrelmail" ,
    "begin" : 698 ,
    "end" : 710 ,
    "canonicalForm" : "SquirrelMail" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E10" ,
    "keyid" : "MalwareFamily#5b451e763c7e8196364f41a9566a47d9" ,
    "type" : "MalwareFamily" ,
    "subType" : "MalwareFamily" ,
    "value" : "exploitation" ,
    "begin" : 902 ,
    "end" : 914 ,
    "canonicalForm" : "exploitation" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E11" ,
    "keyid" : "3f858cf8cfd59f25010e71b6b5671428" ,
    "type" : "MiscEntity" ,
    "subType" : "attacker" ,
    "value" : "attacker" ,
    "begin" : 920 ,
    "end" : 928 ,
    "canonicalForm" : "attacker" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E12" ,
    "keyid" : "DomainName#db428a5a9353710d4fd2c1fc4da66f19" ,
    "type" : "DomainName" ,
    "subType" : "DomainName" ,
    "value" : "sendmail.cf" ,
    "begin" : 943 ,
    "end" : 954 ,
    "canonicalForm" : "sendmail.cf" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E13" ,
    "keyid" : "96f5d833818184efa04c69939710e5f7" ,
    "type" : "MiscEntity" ,
    "subType" : "attachment" ,
    "value" : "email attachment" ,
    "begin" : 966 ,
    "end" : 982 ,
    "canonicalForm" : "email attachment" ,
    "score" : "0.0"
  }
  , { 
    "eid" : "E14" ,
    "keyid" : "DomainName#db428a5a9353710d4fd2c1fc4da66f19" ,
    "type" : "DomainName" ,
    "subType" : "DomainName" ,
    "value" : "sendmail.cf" ,
    "begin" : 999 ,
    "end" : 1010 ,
    "canonicalForm" : "sendmail.cf" ,
    "score" : "0.0"
  }
  ,  ] ,
  "relations" : [ { 
    "rid" : "R1" ,
    "type" : "relatedIdentity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 698 ,
      "end" : 710 ,
      "eid" : "E9" ,
      "canonicalForm" : "SquirrelMail"
    }
    ,  ]
  }
  , { 
    "rid" : "R2" ,
    "type" : "inject" ,
    "predicate" : { 
      "begin" : 929 ,
      "end" : 994 ,
      "surfaceForm" : "must upload a sendmail.cf file as an email attachment, and inject"
    }
     ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 920 ,
      "end" : 928 ,
      "eid" : "E11" ,
      "canonicalForm" : "attacker"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 943 ,
      "end" : 954 ,
      "eid" : "E12" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R3" ,
    "type" : "relatedFileName" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 298 ,
      "end" : 320 ,
      "eid" : "E5" ,
      "canonicalForm" : "Deliver_SendMail.class"
    }
    ,  ]
  }
  , { 
    "rid" : "R4" ,
    "type" : "relatedEntity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 0 ,
      "end" : 12 ,
      "eid" : "E1" ,
      "canonicalForm" : "SquirrelMail"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 93 ,
      "end" : 114 ,
      "eid" : "E3" ,
      "canonicalForm" : "remote code execution"
    }
    ,  ]
  }
  , { 
    "rid" : "R5" ,
    "type" : "relatedDomainName" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 999 ,
      "end" : 1010 ,
      "eid" : "E14" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R6" ,
    "type" : "relatedEntity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 298 ,
      "end" : 320 ,
      "eid" : "E5" ,
      "canonicalForm" : "Deliver_SendMail.class"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 315 ,
      "end" : 324 ,
      "eid" : "E7" ,
      "canonicalForm" : "class.php"
    }
    ,  ]
  }
  , { 
    "rid" : "R7" ,
    "type" : "relatedDomainName" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 943 ,
      "end" : 954 ,
      "eid" : "E12" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R8" ,
    "type" : "relatedEntity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 943 ,
      "end" : 954 ,
      "eid" : "E12" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R9" ,
    "type" : "allow" ,
    "predicate" : { 
      "begin" : 66 ,
      "end" : 72 ,
      "surfaceForm" : "allows"
    }
     ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 0 ,
      "end" : 12 ,
      "eid" : "E1" ,
      "canonicalForm" : "SquirrelMail"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 73 ,
      "end" : 77 ,
      "eid" : "E2" ,
      "canonicalForm" : "post"
    }
    ,  ]
  }
  , { 
    "rid" : "R10" ,
    "type" : "relatedIdentity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 0 ,
      "end" : 12 ,
      "eid" : "E1" ,
      "canonicalForm" : "SquirrelMail"
    }
    ,  ]
  }
  , { 
    "rid" : "R11" ,
    "type" : "relatedDomainName" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 121 ,
      "end" : 132 ,
      "eid" : "E4" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R12" ,
    "type" : "upload_sendmail_cf_file_as" ,
    "predicate" : { 
      "begin" : 929 ,
      "end" : 962 ,
      "surfaceForm" : "must upload a sendmail.cf file as"
    }
     ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 943 ,
      "end" : 954 ,
      "eid" : "E12" ,
      "canonicalForm" : "sendmail.cf"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 966 ,
      "end" : 982 ,
      "eid" : "E13" ,
      "canonicalForm" : "email attachment"
    }
    ,  ]
  }
  , { 
    "rid" : "R13" ,
    "type" : "relatedEntity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 0 ,
      "end" : 12 ,
      "eid" : "E1" ,
      "canonicalForm" : "SquirrelMail"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 121 ,
      "end" : 132 ,
      "eid" : "E4" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R14" ,
    "type" : "relatedFileName" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 315 ,
      "end" : 324 ,
      "eid" : "E7" ,
      "canonicalForm" : "class.php"
    }
    ,  ]
  }
  , { 
    "rid" : "R15" ,
    "type" : "relatedEntity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 999 ,
      "end" : 1010 ,
      "eid" : "E14" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R16" ,
    "type" : "use" ,
    "predicate" : { 
      "begin" : 680 ,
      "end" : 684 ,
      "surfaceForm" : "uses"
    }
     ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 666 ,
      "end" : 679 ,
      "eid" : "E8" ,
      "canonicalForm" : "target server"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 698 ,
      "end" : 710 ,
      "eid" : "E9" ,
      "canonicalForm" : "SquirrelMail"
    }
    ,  ]
  }
  , { 
    "rid" : "R17" ,
    "type" : "relatedEntity" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 93 ,
      "end" : 114 ,
      "eid" : "E3" ,
      "canonicalForm" : "remote code execution"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 121 ,
      "end" : 132 ,
      "eid" : "E4" ,
      "canonicalForm" : "sendmail.cf"
    }
    ,  ]
  }
  , { 
    "rid" : "R18" ,
    "type" : "relatedTTP" ,
    "predicate" : { } ,
    "arguments" : [ { 
      "argnum" : 1 ,
      "begin" : 902 ,
      "end" : 914 ,
      "eid" : "E10" ,
      "canonicalForm" : "exploitation"
    }
    , { 
      "argnum" : 2 ,
      "begin" : 93 ,
      "end" : 114 ,
      "eid" : "E3" ,
      "canonicalForm" : "remote code execution"
    }
    ,  ]
  }
  ,  ]
}
