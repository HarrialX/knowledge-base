Original Source:
https://github.com/libguestfs/libguestfs/commit/fa6a76050d82894365dfe32916903ef7fee3ffcd

Commit history:

  @@ -544,7 +544,7 @@ guestfs___check_package_management (guestfs_h *g, struct inspect_fs *fs)
  char *
  guestfs___first_line_of_file (guestfs_h *g, const char *filename)
  {
-  CLEANUP_FREE char **lines = NULL; /* sic: not CLEANUP_FREE_STRING_LIST */
+  char **lines = NULL; /* sic: not CLEANUP_FREE_STRING_LIST */
                This comment has been minimized.

        

Sign in to view
















              Copy link
            

              Quote reply
            









bonzini



Jun 26, 2013





Wouldn't a simpler fix be just to stop calling guestfs___free_string_list?  Since lines[0] == NULL, all it does is free(lines).














              This comment has been minimized.

        

Sign in to view
















              Copy link
            

              Quote reply
            









rwmjones



Jun 27, 2013




  Author


      Collaborator
    


Yeah, that would be another way to fix this, probably simpler.
   int64_t size;
   char *ret;
  
  @@ -573,6 +573,8 @@ guestfs___first_line_of_file (guestfs_h *g, const char *filename)
  
    ret = lines[0];               /* caller frees */
  
+  free (lines);
+ 
   return ret;
  }
  
  
