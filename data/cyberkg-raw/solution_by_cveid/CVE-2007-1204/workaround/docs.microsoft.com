Original Source:
https://docs.microsoft.com/en-us/security-updates/securitybulletins/2007/ms07-019

Workarounds for UPnP Memory Corruption Vulnerability - CVE-2007-1204:
Microsoft has tested the following workarounds. Although these workarounds will not correct the underlying vulnerability, they help block known attack vectors. When a workaround reduces functionality, it is identified in the following section.

Block the following at the firewall:

UDP port 1900 and TCP port 2869

The UPnP framework uses UDP port 1900 and TCP port 2869. Simple Service Discovery Protocol (SSDP) uses multicast searches to discover UPnP devices. Multicast searches are sent to UDP port 1900 using dynamic outgoing ports. Windows Firewall accepts matching multicast search replies that are received within three seconds of a multicast search. Afterward, the firewall will block multicast search replies, even if they match the search requests. For additional information on effects on the UPnP service when configuring the firewall, see Microsoft Knowledge Base Article 886257.
Impact of workaround:

The UPnP framework cannot discover networked UPnP devices that announce themselves. The firewall blocks these incoming announcements.
A control point running on another computer cannot find or control UPnP devices running on a computer running Windows XP SP2. The firewall blocks the incoming UPnP device-related messages.

How to undo workaround:
To undo the workaround, re-enable UDP port 1900 and TCP port 2869 on the firewall.

Disable the Universal Plug and Play service
Disabling the UPnP service will help protect the affected computer from attempts to exploit this vulnerability. To disable the UPnP service, follow these steps:

Click Start and then click Control Panel. Alternatively, point to Settings and then click Control Panel.
Double-click Administrative Tools.
Double-click Services.
Double-click Universal Plug and Play Device Host.
In the Startup type list, click Disabled.
Click Stop, and then click OK.

You can also stop and disable the UPnP service by using the following command at the command prompt:
sc stop UPnPHost &sc config UPnPHost start= disabled
Impact of workaround: If you disable the UPnP service, components that are dependent on the UPnP service may not operate correctly.
How to undo workaround:
To undo the workaround, re-enable the UPnP service. To do so, follow these steps:

Click Start and then click Control Panel. Alternatively, point to Settings and then click Control Panel.
Double-click Administrative Tools.
Double-click Services.
Double-click Universal Plug and Play Device Host.
In the Startup type list, click Manual.
Click Start, and then click OK.


To help protect from network-based attempts to exploit this vulnerability, enable advanced TCP/IP filtering on systems that support this feature.
You can enable advanced TCP/IP filtering to block all unsolicited inbound traffic. For more information about how to configure TCP/IP filtering, see Microsoft Knowledge Base Article 309798.

To help protect from network-based attempts to exploit this vulnerability, block the affected ports by using IPSec on the affected systems.
Use Internet Protocol security (IPSec) to help protect network communications. Detailed information about IPSec and about how to apply filters is available in Microsoft Knowledge Base Article 313190 and Microsoft Knowledge Base Article 813878.


