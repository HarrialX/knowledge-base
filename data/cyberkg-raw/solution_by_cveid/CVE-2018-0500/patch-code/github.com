Original Source:
https://github.com/curl/curl/commit/ba1dbd78e5f1ed67c1b8d37ac89d90e5e330b628

Commit history:

  @@ -1563,13 +1563,14 @@ CURLcode Curl_smtp_escape_eob(struct connectdata *conn, const ssize_t nread)
   if(!scratch || data->set.crlf) {
      oldscratch = scratch;
  
-     scratch = newscratch = malloc(2 * data->set.buffer_size);
+     scratch = newscratch = malloc(2 * UPLOAD_BUFSIZE);
   if(!newscratch) {
   failf(data, "Failed to alloc scratch buffer!");
  
   return CURLE_OUT_OF_MEMORY;
      }
    }
+  DEBUGASSERT(UPLOAD_BUFSIZE >= nread);
  
   /* Have we already sent part of the EOB? */
    eob_sent = smtp->eob;
  
