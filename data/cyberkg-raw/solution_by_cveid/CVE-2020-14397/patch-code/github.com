Original Source:
https://github.com/LibVNC/libvncserver/commit/38e98ee61d74f5f5ab4aa4c77146faad1962d6d0

Commit history:

  @@ -51,24 +51,30 @@ sraSpanDup(const sraSpan *src) {
  
  static void
  sraSpanInsertAfter(sraSpan *newspan, sraSpan *after) {
-   newspan->_next = after->_next;
-   newspan->_prev = after;
-   after->_next->_prev = newspan;
-   after->_next = newspan;
+  if(newspan && after) {
+     newspan->_next = after->_next;
+     newspan->_prev = after;
+     after->_next->_prev = newspan;
+     after->_next = newspan;
+   }
  }
  
  static void
  sraSpanInsertBefore(sraSpan *newspan, sraSpan *before) {
-   newspan->_next = before;
-   newspan->_prev = before->_prev;
-   before->_prev->_next = newspan;
-   before->_prev = newspan;
+  if(newspan && before) {
+     newspan->_next = before;
+     newspan->_prev = before->_prev;
+     before->_prev->_next = newspan;
+     before->_prev = newspan;
+   }
  }
  
  static void
  sraSpanRemove(sraSpan *span) {
-   span->_prev->_next = span->_next;
-   span->_next->_prev = span->_prev;
+  if(span) {
+     span->_prev->_next = span->_next;
+     span->_next->_prev = span->_prev;
+   }
  }
  
  static void
  
  @@ -207,6 +207,8 @@ rfbClientIteratorHead(rfbClientIteratorPtr i)
  rfbClientPtr
  rfbClientIteratorNext(rfbClientIteratorPtr i)
  {
+  if (!i)
+  return NULL;
   if(i->next == 0) {
   LOCK(rfbClientListMutex);
      i->next = i->screen->clientHead;
  @@ -231,7 +233,7 @@ rfbClientIteratorNext(rfbClientIteratorPtr i)
  void
  rfbReleaseClientIterator(rfbClientIteratorPtr iterator)
  {
-  if(iterator->next) rfbDecrClientRef(iterator->next);
+  if(iterator && iterator->next) rfbDecrClientRef(iterator->next);
   free(iterator);
  }
  
  
